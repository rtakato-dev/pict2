# PICTラッパーCUIツール 仕様書

## 1. 目的

本ツールは、Microsoft PICT を Python でラップした CUI（コマンドライン）ツールとして提供し、
ペアワイズテスト設計をはじめとする組み合わせテストを **現場で使いやすい形で実行・管理** できることを目的とする。

* Python 実行環境を必要としない `.exe` 形式で配布する
* PICT の標準機能を最大限活用しつつ、設定ファイルによる拡張性を持たせる
* 将来的なテスト設計支援（制約比較・期待結果定義）に耐える設計とする

---

## 2. 提供形態

* Windows 向け CUI アプリケーション
* 単体実行可能な `.exe` ファイル
* 内部で `pict.exe` を同梱し、ユーザーは PICT を意識せず利用可能

---

## 3. 想定利用者

* テスト設計者
* QAエンジニア
* 組み合わせテストを業務で利用する開発者

---

## 4. 実行イメージ（CLI）

本ツールは、以下の形式で実行する CUI アプリケーションとして提供する。

```bash
pict2 -option1 -option2 value
```

* コマンド名は `pict2` とする
* オプションは PICT のオプション体系を踏襲し、短縮指定・値指定の双方に対応する
* オプション指定がない場合は、設定ファイル（YAML）に定義されたデフォルト設定を使用する

例：

```bash
pict2 model.pict -o 2 -r
```

---

## 5. 機能一覧

### 5.0 オプション対応方針

本ツールは、PICT の主要オプションについて **部分互換モード** を提供する。

* CLI オプションは **short オプション（`-o` 等）を正式仕様として先行実装** する
* long オプション（`--order` 等）は **将来拡張として予約** し、後方互換を維持する
* short / long は同一意味を持つエイリアスとして扱う
* PICT の全オプション互換は目指さず、対応範囲を明示する
* CLI で指定されたオプションは YAML 設定より常に優先される
* 本ツール独自の拡張オプションは、PICT 実行前後に内部変換処理を行う

---|---|
| PICT実行 | 指定したモデルファイルを元に組み合わせ生成を行う |
| exe化 | Python環境不要で実行可能 |
| 出力生成 | CSV等のファイルとして結果を出力 |

---

### 5.2 PICTオプション対応

#### 5.2.1 対応するPICTオプション

以下の PICT オプションについては、本ツールで対応する。
CLI では **short オプションを正式仕様** とし、long オプションは将来拡張とする。

#### オプション引数の扱い方針

* `-r` オプションは **同一オプションとして扱う**

  * 引数なしの場合：ランダム化を有効にする
  * 引数ありの場合：ランダム化を有効にし、引数をシード値として解釈する

* 本挙動は PICT の仕様に準拠する

* 本機能は **利用頻度が低いため実装優先度を低** とする

* `-o` オプションは **ツール側で意味解釈を行う**

  * 数値が指定された場合：n-wise 組み合わせとして扱う

    * `1` は有効な値として許可する
    * `0` および負数は許可しない
  * `max` が指定された場合：全網羅（直積）として扱う
  * `-o` が未指定の場合：暗黙的に `max` が指定されたものとして扱う
  * 不正な値（`0`、負数、解釈不能な文字列）が指定された場合のエラーメッセージは **PICT の仕様・表現を踏襲** する
  * `max` が指定された場合：全網羅（直積）として扱う
  * `-o` が未指定の場合：暗黙的に `max` が指定されたものとして扱う

| PICTオプション | CLI指定例（short） | 予約longオプション         | YAMLキー                         | 備考                             |          |
| --------- | ------------- | ------------------- | ------------------------------ | ------------------------------ | -------- |
| `/o`      | `-o 2`        | `--order`           | `pict_options.order`           | `max` 指定で全網羅                   |          |
| `/r`      | `-r`          | `--random`          | `pict_options.random`          | シード未指定                         |          |
| `/r:N`    | `-r 42`       | `--seed`            | `pict_options.seed`            | ランダムシード指定                      |          |
| `/d`      | `-d ,`        | `--delimiter`       | `pict_options.delimiter`       | 値区切り文字                         |          |
| `/a`      | `-a           | `                   | `--alias-delimiter`            | `pict_options.alias_delimiter` | エイリアス区切り |
| `/n`      | `-n ~`        | `--negative-prefix` | `pict_options.negative_prefix` | 否定値接頭辞                         |          |
| `/e`      | `-e seed.txt` | `--seed-file`       | `pict_options.seed_file`       | シード行指定                         |          |
| `/c`      | `-c`          | `--case-sensitive`  | `pict_options.case_sensitive`  | 大文字小文字区別                       |          |
| `/s`      | `-s`          | `--stats`           | ―                              | CLI のみ対応                       |

---

#### 5.2.2 対応しないPICTオプション（仕様外）

以下の PICT オプションは、本ツールでは **仕様外** とする。

* 内部デバッグ用途のオプション
* 出力フォーマットを直接変更するオプション
* 将来の PICT バージョン依存の拡張オプション

これらは CLI / YAML のいずれからも指定不可とし、
指定された場合はエラーとして扱う。

---

### 5.3 因子・水準の並び替え機能

* モデルファイル内の因子および水準の順序をツール側で制御可能
* 出力結果の列順・値順を安定させる目的で使用する
* 並び替えルールは設定ファイルで定義可能とする

---

### 5.4 設定ファイル（YAML）による制御

#### 5.4.1 概要

* YAML ファイルを用いてツールのデフォルト挙動を変更可能
* **CLI で指定されたオプションが存在する場合は、該当項目について YAML の設定を無効化し、CLI の指定を最優先とする**
* CLI 未指定の項目のみ、YAML の設定を補完的に使用する

#### 5.4.2 設定の優先順位

設定値の適用優先順位は以下の通りとする。

1. CLI オプション指定
2. YAML 設定ファイル
3. ツール内デフォルト値

#### 5.4.3 設定可能項目（例）

* 常に付与する PICT オプション
* 組み合わせ生成方式（全網羅 / ペアワイズ等）
* 出力形式
* ディシジョンテーブル変換の有無

---

### 5.5 デフォルト組み合わせ方式

* デフォルトでは **全網羅（直積）** による組み合わせを生成する
* YAML 設定により、ペアワイズ（order=2）等へ変更可能

---

### 5.6 ディシジョンテーブル変換（オプション）

* PICT の出力結果をディシジョンテーブル形式へ変換可能
* 変換の有無・形式は YAML で制御可能
* 将来的なテストケース管理ツールとの連携を想定

---

### 5.7 制約付き組み合わせと全網羅の比較（低優先度）

* 制約条件を付与した場合に、

  * 全網羅時の組み合わせ数
  * 制約適用後の組み合わせ数
    を比較できるオプションを提供

* 実装優先度：低

* YAML により有効・無効を制御可能

---

### 5.8 期待結果の記述（低優先度）

* 各組み合わせに対して期待結果を定義できる拡張機能
* ディシジョンテーブルやテストケース生成との連携を想定
* 現時点では設計のみとし、実装は後続フェーズで対応

---

## 6. 設定ファイル例（イメージ）

```yaml
default:
  combination: exhaustive
  pict_options:
    order: 2
    random: true

output:
  decision_table: true

compare:
  enable: false
```

---

## 7. 非機能要件

* 実行時に Python 環境を要求しない
* エラー発生時は原因を CUI に明示的に出力する
* 将来的な機能追加（lint / stats / VSCode連携）を考慮した構造とする

---

## 8. 今後の拡張予定

* モデルファイルの構文チェック（lint）
* 組み合わせ数・因子数の統計情報出力
* VSCode拡張との共通ロジック化

---

## 9. 備考

本仕様書は初期設計段階のものであり、
実装状況や利用フィードバックに応じて随時更新するものとする。
